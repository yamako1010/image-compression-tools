<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>画像圧縮・最適化ツール</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #fef3c7, #fce7f3, #ede9fe, #e0e7ff, #ecfdf5);
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
            min-height: 100vh;
        }
        
        .blob-animation {
            position: absolute;
            border-radius: 50%;
            mix-blend-mode: multiply;
            filter: blur(40px);
            opacity: 0.7;
            animation: blob 7s infinite;
            pointer-events: none;
            z-index: -1;
        }
        
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        
        .blob-1 {
            top: -10%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #ec4899, #f59e0b);
            animation-delay: 0s;
        }
        
        .blob-2 {
            bottom: -10%;
            left: -10%;
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #8b5cf6, #06b6d4);
            animation-delay: 2s;
        }
        
        .blob-3 {
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #10b981, #f59e0b);
            animation-delay: 4s;
        }
        
        /* かわいいアニメーション */
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-3deg); }
            75% { transform: rotate(3deg); }
        }
        
        @keyframes bounce-cute {
            0%, 100% { transform: translateY(0) scale(1); }
            25% { transform: translateY(-8px) scale(1.05); }
            50% { transform: translateY(-15px) scale(1.1); }
            75% { transform: translateY(-8px) scale(1.05); }
        }
        
        @keyframes pulse-heart {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .wiggle { animation: wiggle 1s infinite; }
        .bounce-cute { animation: bounce-cute 2s infinite; }
        .pulse-heart { animation: pulse-heart 1.5s infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        
        .drop-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        
        .drop-zone.dragover {
            border-color: #475569;
            background-color: #f8fafc;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #475569;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        body {
            font-family: 'Noto Sans JP', 'Zen Kaku Gothic New', sans-serif;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        /* かわいいスライダースタイル */
        .slider-thumb {
            cursor: pointer;
            position: relative;
        }
        
        .slider-thumb::-webkit-slider-thumb {
            appearance: none;
            height: 32px;
            width: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ec4899, #8b5cf6);
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4), 0 0 0 3px rgba(236, 72, 153, 0.2);
            transition: all 0.3s ease;
        }
        
        .slider-thumb::-webkit-slider-thumb:hover {
            background: linear-gradient(45deg, #f472b6, #a855f7);
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.6), 0 0 0 4px rgba(236, 72, 153, 0.3);
            filter: brightness(1.1);
        }
        
        .slider-thumb::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.8), 0 0 0 2px rgba(236, 72, 153, 0.4);
        }
        
        .slider-thumb::-moz-range-thumb {
            height: 32px;
            width: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ec4899, #8b5cf6);
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4), 0 0 0 3px rgba(236, 72, 153, 0.2);
            transition: all 0.3s ease;
            border: none;
        }
        
        .slider-thumb::-moz-range-thumb:hover {
            background: linear-gradient(45deg, #f472b6, #a855f7);
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.6), 0 0 0 4px rgba(236, 72, 153, 0.3);
        }
        
        .slider-thumb::-moz-range-thumb:active {
            cursor: grabbing;
            transform: scale(1.1);
        }
        
        /* スライダートラックのスタイル */
        .slider-thumb::-webkit-slider-runnable-track {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #e2e8f0, #cbd5e1);
        }
        
        .slider-thumb::-moz-range-track {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #e2e8f0, #cbd5e1);
            border: none;
        }
        
        /* パルスアニメーション */
        @keyframes slider-pulse {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4), 0 0 0 3px rgba(236, 72, 153, 0.2);
            }
            50% {
                box-shadow: 0 4px 12px rgba(236, 72, 153, 0.6), 0 0 0 5px rgba(236, 72, 153, 0.3);
            }
        }
        
        .slider-thumb:focus::-webkit-slider-thumb {
            animation: slider-pulse 2s infinite;
            outline: none;
        }
        
        .slider-thumb:focus::-moz-range-thumb {
            animation: slider-pulse 2s infinite;
            outline: none;
        }
        
        /* 成功アニメーション */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .compression-success {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes slideInTop {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Animated background blobs -->
    <div class="blob-animation blob-1"></div>
    <div class="blob-animation blob-2"></div>
    <div class="blob-animation blob-3"></div>
    
    <div class="container mx-auto px-4 py-8 max-w-6xl relative z-10">
        <!-- ヘッダー -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-4" style="background: linear-gradient(45deg, #8b5cf6, #ec4899, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                画像圧縮・最適化ツール
            </h1>
            <p class="text-lg font-semibold mb-6" style="background: linear-gradient(45deg, #059669, #0284c7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                シンプルで高品質な画像・PDF圧縮ツール
            </p>
            
            <!-- 使い方説明 -->
            <div class="p-6 max-w-3xl mx-auto rounded-2xl shadow-xl" style="background: linear-gradient(135deg, #fef3c7, #fce7f3, #e0e7ff); border: 2px solid #ec4899; transform: translateY(0); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 25px 50px -12px rgba(0, 0, 0, 0.25)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 15px -3px rgba(0, 0, 0, 0.1)'">
                <h2 class="text-lg font-bold mb-3" style="background: linear-gradient(45deg, #8b5cf6, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    ⚡ 簡単３ステップ
                </h2>
                <div class="grid md:grid-cols-3 gap-4 text-sm">
                    <div class="text-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.6);">
                        <div class="text-2xl mb-2">1</div>
                        <p class="font-semibold" style="color: #8b5cf6;">画像またはPDFをアップロード</p>
                    </div>
                    <div class="text-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.6);">
                        <div class="text-2xl mb-2">2</div>
                        <p class="font-semibold" style="color: #ec4899;">スライダーで圧縬レベル調整</p>
                    </div>
                    <div class="text-center p-3 rounded-xl" style="background: rgba(255, 255, 255, 0.6);">
                        <div class="text-2xl mb-2">3</div>
                        <p class="font-semibold" style="color: #f59e0b;">結果をダウンロード</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 画像アップロード -->
        <div class="mb-8">
            <h2 class="text-xl font-bold mb-6 text-center flex items-center justify-center gap-3">
                <svg class="w-6 h-6" style="color: #8b5cf6;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <span style="background: linear-gradient(45deg, #8b5cf6, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">ファイルアップロード</span>
                <svg class="w-6 h-6" style="color: #ec4899;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            </h2>
            <div class="drop-zone rounded-2xl p-12 text-center shadow-xl" id="dropZone" style="background: linear-gradient(135deg, #ffffff, #fef3c7); border: 3px dashed #ec4899; transition: all 0.3s ease; transform: scale(1);" onmouseover="this.style.transform='scale(1.02)'; this.style.background='linear-gradient(135deg, #fef3c7, #fce7f3)'" onmouseout="this.style.transform='scale(1)'; this.style.background='linear-gradient(135deg, #ffffff, #fef3c7)'">
                <div class="flex justify-center gap-4 mb-6">
                    <svg class="w-16 h-16 animate-bounce" style="color: #8b5cf6;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <svg class="w-16 h-16 animate-bounce" style="color: #ec4899; animation-delay: 0.2s;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <p class="text-lg font-semibold mb-6" style="color: #374151;">画像やPDFをドラッグ&ドロップしてください</p>
                <p class="text-sm mb-6" style="color: #6b7280;">対応フォーマット: JPG, PNG, GIF, WebP, PDF</p>
                <input type="file" id="fileInput" accept="image/*,application/pdf" class="hidden">
                <button onclick="document.getElementById('fileInput').click()" 
                        class="text-white px-8 py-4 font-bold text-lg rounded-full shadow-lg transition-all duration-200" style="background: linear-gradient(45deg, #8b5cf6, #ec4899); transform: scale(1);" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)'">
                    ファイルを選択
                </button>
            </div>
        </div>
        
        <!-- シェアボタン（常に表示） -->
        <div class="mb-8">
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 border border-blue-200">
                <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                    </svg>
                    友達にシェアしよう
                </h3>
                <div class="flex flex-wrap gap-2">
                    <button id="shareTwitter" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                        </svg>
                        X (Twitter)
                    </button>
                    <button id="shareLine" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19.365 9.863c.349 0 .63.285.63.635 0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635zm.875 0c.349 0 .63.285.63.635 0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635zm-13.72.635c0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635.349 0 .63.285.63.635zm.875-.635c.349 0 .63.285.63.635 0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635zm6.724-2.49c.345 0 .627.285.627.635 0 .35-.282.635-.627.635-.349 0-.63-.285-.63-.635 0-.35.281-.635.63-.635z"></path>
                        </svg>
                        LINE
                    </button>
                    <button id="copyUrl" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        URLをコピー
                    </button>
                    <button id="shareFacebook" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                        </svg>
                        Facebook
                    </button>
                </div>
            </div>
        </div>

        <!-- プレビューエリア -->
        <div id="previewArea" class="hidden space-y-8">
            <!-- 画質設定 -->
            <div class="bg-white rounded-lg p-6">
                <h2 class="text-lg font-bold mb-2 flex items-center gap-2" style="background: linear-gradient(45deg, #8b5cf6, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    <svg class="w-5 h-5" style="color: #f59e0b;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    画質設定
                </h2>
                <p class="text-sm font-semibold mb-4 flex items-center gap-2" style="color: #8b5cf6;">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3.5M3 16.5h18"></path>
                    </svg>
                    スライダーでお好みの画質に調整できます
                </p>
                <div class="flex items-center gap-6">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-slate-600 mb-3">
                            画質: <span id="qualityValue">80</span>%
                        </label>
                        <input type="range" id="qualitySlider" min="10" max="100" value="80" 
                               class="w-full h-3 bg-slate-200 rounded-lg appearance-none slider-thumb">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>小さく</span>
                            <span>高画質</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-light text-slate-800" id="qualityDisplay">80%</div>
                        <div class="text-xs text-slate-500">画質</div>
                    </div>
                </div>
            </div>

            <!-- 圧縮結果 -->
            <div class="bg-white rounded-lg p-6">
                <h2 class="text-lg font-light text-slate-700 mb-6 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                    </svg>
                    圧縮結果
                </h2>
                
                <!-- 圧縮結果の視覚的表示 -->
                <div id="compressionStats" style="display: none;" class="mb-8">
                    <!-- 節約容量の大きな表示 -->
                    <div id="savingsDisplay" class="text-center mb-6 p-6 rounded-2xl" style="background: linear-gradient(135deg, #ecfdf5, #d1fae5); border: 2px solid #10b981;">
                        <div class="flex items-center justify-center gap-3 mb-2">
                            <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                            <h3 class="text-2xl font-bold text-emerald-800">容量削減効果</h3>
                        </div>
                        <div id="savingsAmount" class="text-4xl font-bold text-emerald-700 mb-2">-</div>
                        <div id="savingsPercentage" class="text-lg text-emerald-600 font-medium">-</div>
                        <div class="mt-4">
                            <div class="bg-white/60 rounded-full h-4 overflow-hidden">
                                <div id="savingsBar" class="h-full bg-gradient-to-r from-emerald-500 to-green-500 transition-all duration-1000" style="width: 0%;"></div>
                            </div>
                            <div class="flex justify-between text-sm text-emerald-600 mt-2">
                                <span>元のサイズ</span>
                                <span id="originalSizeLabel">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 詳細統計 -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-white rounded-xl border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-center mb-2">
                                <svg class="w-5 h-5 text-blue-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span class="text-sm font-medium text-gray-600">圧縮後</span>
                            </div>
                            <div class="text-2xl font-bold text-blue-600" id="compressedSize">-</div>
                        </div>
                        
                        <div class="text-center p-4 bg-white rounded-xl border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-center mb-2">
                                <svg class="w-5 h-5 text-purple-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                                </svg>
                                <span class="text-sm font-medium text-gray-600">圧縮率</span>
                            </div>
                            <div class="text-2xl font-bold text-purple-600" id="compressionRatio">-</div>
                        </div>
                        
                        <div class="text-center p-4 bg-white rounded-xl border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-center mb-2">
                                <svg class="w-5 h-5 text-indigo-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span class="text-sm font-medium text-gray-600">解像度</span>
                            </div>
                            <div class="text-2xl font-bold text-indigo-600" id="resolution">-</div>
                        </div>
                    </div>
                </div>

                <!-- 画像プレビュー -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h3 class="text-sm font-medium text-slate-600 mb-3">元画像</h3>
                        <div class="border rounded-lg overflow-hidden bg-slate-50">
                            <img id="originalImage" class="w-full h-auto max-h-64 object-contain">
                        </div>
                        <p id="originalInfo" class="text-xs text-slate-500 mt-2"></p>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-medium text-slate-600 mb-3">圧縮後</h3>
                        <div class="border rounded-lg overflow-hidden bg-slate-50">
                            <img id="compressedImage" class="w-full h-auto max-h-64 object-contain">
                        </div>
                        <p id="compressedInfo" class="text-xs text-slate-500 mt-2"></p>
                    </div>
                </div>

                <!-- アクションボタン -->
                <div class="flex flex-wrap gap-3 mb-6">
                    <button id="downloadBtn" 
                            class="bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 transition-colors flex items-center gap-2 hidden font-medium rounded-lg">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        ダウンロード
                    </button>
                    <button id="resetBtn" 
                            class="border border-slate-300 hover:bg-slate-50 text-slate-700 px-6 py-3 transition-colors flex items-center gap-2 font-medium rounded-lg">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0V9a8 8 0 1115.356 2M15 15v5h-.582M4.582 15A8.001 8.001 0 0019.418 9m0 0V9a8 8 0 10-15.356 2"></path>
                        </svg>
                        リセット
                    </button>
                </div>
                
                <!-- 圧縮結果用シェアボタン -->
                <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-4 mb-6 border border-orange-200">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        <svg class="w-4 h-4 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                        圧縮成功！友達にシェアしよう
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <button id="shareTwitterResult" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center gap-2 transition-colors">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
                            </svg>
                            Xでシェア
                        </button>
                        <button id="shareLineResult" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center gap-2 transition-colors">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.365 9.863c.349 0 .63.285.63.635 0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635zm.875 0c.349 0 .63.285.63.635 0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635zm-13.72.635c0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635.349 0 .63.285.63.635zm.875-.635c.349 0 .63.285.63.635 0 .35-.281.635-.63.635-.345 0-.627-.285-.627-.635 0-.35.282-.635.627-.635zm6.724-2.49c.345 0 .627.285.627.635 0 .35-.282.635-.627.635-.349 0-.63-.285-.63-.635 0-.35.281-.635.63-.635z"></path>
                            </svg>
                            LINEでシェア
                        </button>
                        <button id="copyUrlResult" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center gap-2 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            URLコピー
                        </button>
                        <button id="shareFacebookResult" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center gap-2 transition-colors">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path>
                            </svg>
                            Facebookでシェア
                        </button>
                    </div>
                </div>
                
                
                <!-- 適用可能サービス -->
                <div id="suitableServices" style="display: none;">
                    <h3 class="text-sm font-medium text-slate-600 mb-3">このサイズで利用可能なサービス</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="servicesList">
                        <!-- サービス一覧はJavaScriptで生成 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ローディング画面 -->
        <div id="loadingScreen" class="fixed inset-0 flex items-center justify-center z-50" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.8), rgba(236, 72, 153, 0.8), rgba(245, 158, 11, 0.8)); display: none;">
            <div class="rounded-2xl p-8 text-center max-w-md mx-4 relative overflow-hidden" style="background: linear-gradient(135deg, #ffffff, #fef3c7); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); border: 3px solid #ec4899;">
                <!-- 装飾要素 -->
                <div class="absolute top-2 left-2 w-3 h-3 bg-purple-300 rounded-full float"></div>
                <div class="absolute top-4 right-4 w-4 h-4 bg-pink-300 rounded-full wiggle"></div>
                <div class="absolute bottom-2 left-4 w-2 h-2 bg-yellow-300 rounded-full pulse-heart"></div>
                <div class="absolute bottom-4 right-2 w-3 h-3 bg-blue-300 rounded-full bounce-cute"></div>
                
                <div class="mb-4">
                    <div class="w-20 h-20 mx-auto rounded-full bounce-cute" style="background: linear-gradient(45deg, #8b5cf6, #ec4899, #f59e0b); animation: spin 2s linear infinite;">
                        <div class="w-full h-full rounded-full flex items-center justify-center" style="background: linear-gradient(45deg, #ec4899, #f59e0b);">
                            <div class="w-8 h-8 rounded-full bg-white"></div>
                        </div>
                    </div>
                </div>
                <p class="text-lg font-bold mb-3 wiggle" style="color: #8b5cf6;" id="loadingMessage">お仕事おつかれさま！</p>
                <p class="text-sm font-medium pulse-heart" style="color: #ec4899;" id="loadingSubMessage">今日めっちゃいいことおきるよ！</p>
                
                <!-- プログレスバー -->
                <div class="mt-6 w-full bg-purple-200 rounded-full h-3">
                    <div id="progressBar" class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-300" style="width: 0%;"></div>
                </div>
                <div id="progressText" class="text-xs text-purple-600 text-center mt-2 font-medium">0%</div>
            </div>
        </div>
        
        <!-- ツール作成者・クレジットセクション -->
        <div class="mt-12 pt-8 border-t border-gray-200">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- ツール作成者情報 -->
                <div class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-indigo-200 shadow-lg">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white">
                            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                <circle cx="9" cy="9" r="1" fill="currentColor" />
                                <circle cx="15" cy="9" r="1" fill="currentColor" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6" stroke-width="3" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                やまこ
                            </h3>
                            <p class="text-sm font-medium text-indigo-600">ツール作成者</p>
                        </div>
                    </div>
                    <div class="space-y-2 mb-4">
                        <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
                            <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                            </svg>
                            AIWEBツール作成
                        </div>
                        <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
                            <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9m0 0l-2-2m2 2l2-2"></path>
                            </svg>
                            AIWEBサイト作成
                        </div>
                        <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
                            <svg class="w-4 h-4 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            AI活用パートナー
                        </div>
                    </div>
                    <div class="bg-white/60 rounded-lg p-3 text-center">
                        <p class="text-sm font-medium text-gray-600 mb-2">このツールは</p>
                        <p class="text-lg font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                            バイブコーディングで作成しました
                        </p>
                    </div>
                </div>
                
                <!-- その他ツール -->
                <div class="bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 rounded-2xl p-6 border-2 border-emerald-200 shadow-lg">
                    <div class="flex items-center gap-3 mb-4">
                        <svg class="w-8 h-8 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                        </svg>
                        <h3 class="text-xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                            その他の便利ツール
                        </h3>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">
                        やまこが作成した他の無料AIツールをチェックしてみてください
                    </p>
                    <button id="moreToolsBtn" class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                        その他便利ツールを見る
                    </button>
                </div>
            </div>
            
            <!-- フッター -->
            <div class="text-center mt-8 pt-6 border-t border-gray-200">
                <p class="text-sm text-gray-500">
                    © 2024 やまこ | AI活用パートナー | バイブコーディングで作成
                </p>
            </div>
        </div>
    </div>

    <script>
        // Service configurations
        const services = {
            instagram: {
                name: 'Instagram',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>',
                maxWidth: 1080,
                maxHeight: 1080,
                maxSize: 8 * 1024 * 1024,
                description: '最大8MB、1080×1080px'
            },
            line: {
                name: 'LINE',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>',
                maxWidth: 1024,
                maxHeight: 1024,
                maxSize: 10 * 1024 * 1024,
                description: '最大10MB、1024×1024px'
            },
            web: {
                name: 'ウェブ',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>',
                maxWidth: 1200,
                maxHeight: 800,
                maxSize: 15 * 1024 * 1024,
                description: '最大15MB、1200×800px'
            },
            mobile: {
                name: 'モバイル',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a1 1 0 001-1V4a1 1 0 00-1-1H8a1 1 0 00-1 1v16a1 1 0 001 1z"></path></svg>',
                maxWidth: 750,
                maxHeight: 1334,
                maxSize: 5 * 1024 * 1024,
                description: '最大5MB、750×1334px'
            },
            email: {
                name: 'メール',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>',
                maxWidth: 800,
                maxHeight: 600,
                maxSize: 5 * 1024 * 1024,
                description: '最大5MB、800×600px'
            },
            youtube: {
                name: 'YouTube',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>',
                maxWidth: 1280,
                maxHeight: 720,
                maxSize: 20 * 1024 * 1024,
                description: '最大20MB、1280×720px'
            },
            sns: {
                name: 'SNS',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>',
                maxWidth: 1200,
                maxHeight: 630,
                maxSize: 8 * 1024 * 1024,
                description: '最大8MB、1200×630px'
            },
            print: {
                name: '印刷用',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>',
                maxWidth: 1920,
                maxHeight: 1080,
                maxSize: 10 * 1024 * 1024,
                description: '最大10MB、1920×1080px'
            }
        };

        // Loading messages
        const loadingMessages = [
            'お仕事おつかれさま！',
            '今日はきっといい日になるよ！',
            'あなたはすごい人です！',
            '明日はもっといいことがあるよ！',
            'あなたの笑顔が一番素敵！',
            '今日もがんばっていてえらい！',
            'すてきな一日になりそう！',
            'あなたは本当に特別です！'
        ];

        // Loading sub messages
        const loadingSubMessages = [
            '今日めっちゃいいことおきるよ！',
            'あなたはとっても素敵です！',
            'みんなあなたのこと大好きです！',
            '今日はきっといい日！',
            'あなたのがんばりすごいです！',
            '幸せはすぐそこに！'
        ];

        let originalFile = null;
        let compressedBlob = null;
        let compressedDimensions = null;
        let fileType = 'image';

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        // イベントリスナー設定
        function setupEventListeners() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const qualitySlider = document.getElementById('qualitySlider');
            const downloadBtn = document.getElementById('downloadBtn');
            const resetBtn = document.getElementById('resetBtn');

            fileInput.addEventListener('change', handleFileSelect);
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);
            qualitySlider.addEventListener('input', function() {
                const value = this.value;
                document.getElementById('qualityValue').textContent = value;
                document.getElementById('qualityDisplay').textContent = value + '%';
                
                // スライダーの背景色を更新
                const percentage = (value - 10) / 90 * 100;
                this.style.background = `linear-gradient(to right, #64748b 0%, #64748b ${percentage}%, #e2e8f0 ${percentage}%, #e2e8f0 100%)`;
                
                if (originalFile) {
                    compressImage();
                }
            });
            downloadBtn.addEventListener('click', downloadImage);
            resetBtn.addEventListener('click', resetAll);
            
            // シェアボタンのイベントリスナー
            document.getElementById('shareTwitter').addEventListener('click', shareOnTwitter);
            document.getElementById('shareLine').addEventListener('click', shareOnLine);
            document.getElementById('copyUrl').addEventListener('click', copyUrlToClipboard);
            document.getElementById('shareFacebook').addEventListener('click', shareOnFacebook);
            
            // 圧縮結果エリアのシェアボタン
            document.getElementById('shareTwitterResult').addEventListener('click', shareOnTwitterWithResult);
            document.getElementById('shareLineResult').addEventListener('click', shareOnLineWithResult);
            document.getElementById('copyUrlResult').addEventListener('click', copyUrlToClipboard);
            document.getElementById('shareFacebookResult').addEventListener('click', shareOnFacebookWithResult);
            
            // その他ツールボタン
            document.getElementById('moreToolsBtn').addEventListener('click', openMoreTools);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function processFile(file) {
            const isImage = file.type.startsWith('image/');
            const isPDF = file.type === 'application/pdf';
            
            if (!isImage && !isPDF) {
                alert('画像ファイルまたはPDFファイルを選択してください。');
                return;
            }

            originalFile = file;
            fileType = isImage ? 'image' : 'pdf';
            
            if (isImage) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const originalImage = document.getElementById('originalImage');
                    originalImage.src = e.target.result;
                    originalImage.style.display = 'block'; // 明示的に表示
                    originalImage.onload = function() {
                        console.log('元画像が読み込まれました');
                    };
                    
                    document.getElementById('originalInfo').textContent = 
                        `${formatFileSize(file.size)} | ${file.type}`;
                    
                    document.getElementById('previewArea').classList.remove('hidden');
                    compressImage();
                };
                reader.onerror = function(e) {
                    console.error('ファイル読み込みエラー:', e);
                    alert('画像ファイルの読み込みに失敗しました。');
                };
                reader.readAsDataURL(file);
            } else {
                // PDFの場合の表示
                const originalImage = document.getElementById('originalImage');
                const originalImageContainer = originalImage.parentElement;
                
                // PDFアイコンを表示
                originalImage.style.display = 'none';
                originalImageContainer.innerHTML = `
                    <div class="w-full h-64 flex flex-col items-center justify-center bg-red-50 border-2 border-red-200 rounded-lg">
                        <svg class="w-16 h-16 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <div class="text-lg font-bold text-red-700 mb-2">PDFファイル</div>
                        <div class="text-sm text-red-600">${file.name}</div>
                    </div>
                `;
                
                document.getElementById('originalInfo').textContent = 
                    `${formatFileSize(file.size)} | ${file.type}`;
                
                document.getElementById('previewArea').classList.remove('hidden');
                compressImage();
            }
        }

        async function compressImage() {
            if (!originalFile) return;

            showLoading();

            try {
                const quality = parseInt(document.getElementById('qualitySlider').value) / 100;
                
                if (fileType === 'image') {
                    updateLoadingMessage('画像を圧縮中...');
                    updateProgress(30);
                    
                    const result = await compressImageWithCanvas(originalFile, quality);
                    compressedBlob = result.blob;
                    compressedDimensions = result.dimensions;
                    
                    updateProgress(70);
                    
                    const compressedImage = document.getElementById('compressedImage');
                    compressedImage.style.display = 'block';
                    compressedImage.src = URL.createObjectURL(compressedBlob);
                    
                    updateProgress(100);
                } else {
                    // PDF圧縮
                    compressedBlob = await compressPDF(originalFile, quality);
                    compressedDimensions = null;
                    
                    const compressedImage = document.getElementById('compressedImage');
                    compressedImage.style.display = 'none';
                }
                
                updateCompressionStats();
                updateSuitableServices();
                
                document.getElementById('downloadBtn').classList.remove('hidden');
                
                setTimeout(() => {
                    hideLoading();
                    showCompletionAnimation();
                }, 1500);

            } catch (error) {
                hideLoading();
                updateLoadingMessage('エラー: ' + error.message);
                alert('圧縮処理中にエラーが発生しました: ' + error.message);
            }
        }

        function compressImageWithCanvas(file, quality) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    let { width, height } = calculateDimensions(img.width, img.height, 1920, 1080);
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    canvas.toBlob((blob) => {
                        resolve({blob, dimensions: {width, height}});
                    }, 'image/jpeg', quality);
                };
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        async function compressPDF(file, quality) {
            updateLoadingMessage('PDFを読み込み中...');
            
            const arrayBuffer = await file.arrayBuffer();
            
            try {
                // PDF.js workerの設定
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
                
                // PDFを読み込み
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                const newPdfDoc = await PDFLib.PDFDocument.create();
                
                updateLoadingMessage(`${pdf.numPages}ページのPDFを圧縮中...`);
                
                const totalPages = pdf.numPages;
                let processedSize = 0;
                let originalEstimatedSize = file.size;
                
                for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                    updateLoadingMessage(`ページ ${pageNum}/${totalPages} を処理中...`);
                    updateProgress((pageNum / totalPages) * 80); // 80%まではページ処理
                    
                    const page = await pdf.getPage(pageNum);
                    
                    // 品質に応じてスケールを調整（低品質ではサイズを小さく）
                    const scale = quality > 0.7 ? 2.0 : quality > 0.4 ? 1.5 : 1.0;
                    const viewport = page.getViewport({ scale: scale });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport,
                    };
                    
                    await page.render(renderContext).promise;
                    
                    // 指定された品質でJPEG圧縮
                    const imageBlob = await new Promise((resolve) => {
                        canvas.toBlob((blob) => {
                            resolve(blob);
                        }, 'image/jpeg', quality);
                    });
                    
                    // PDFに画像を追加
                    const imageBytes = await imageBlob.arrayBuffer();
                    const image = await newPdfDoc.embedJpg(imageBytes);
                    
                    const newPage = newPdfDoc.addPage([image.width, image.height]);
                    newPage.drawImage(image, {
                        x: 0,
                        y: 0,
                        width: image.width,
                        height: image.height,
                    });
                    
                    processedSize += imageBlob.size;
                }
                
                updateLoadingMessage('PDFを保存中...');
                updateProgress(90);
                
                const pdfBytes = await newPdfDoc.save();
                updateProgress(100);
                
                return new Blob([pdfBytes], { type: 'application/pdf' });
                
            } catch (error) {
                console.error('PDF compression error:', error);
                updateLoadingMessage('エラーが発生しました: ' + error.message);
                
                // フォールバック: 単純な再保存
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                const pdfBytes = await pdfDoc.save({
                    useObjectStreams: true, // 圧縮を有効に
                    addDefaultPage: false,
                });
                return new Blob([pdfBytes], { type: 'application/pdf' });
            }
        }

        function calculateDimensions(originalWidth, originalHeight, maxWidth, maxHeight) {
            let width = originalWidth;
            let height = originalHeight;

            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }

            if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
            }

            return { width: Math.round(width), height: Math.round(height) };
        }

        function updateCompressionStats() {
            if (!originalFile || !compressedBlob) return;

            const compressionRatio = Math.round((1 - compressedBlob.size / originalFile.size) * 100);
            const sizeDifference = originalFile.size - compressedBlob.size;
            const compressionEffective = compressionRatio > 0;
            
            // 節約容量の大きな表示
            const savingsDisplay = document.getElementById('savingsDisplay');
            const savingsAmount = document.getElementById('savingsAmount');
            const savingsPercentage = document.getElementById('savingsPercentage');
            const savingsBar = document.getElementById('savingsBar');
            const originalSizeLabel = document.getElementById('originalSizeLabel');
            
            if (compressionEffective) {
                // 成功時の表示
                savingsDisplay.style.background = 'linear-gradient(135deg, #ecfdf5, #d1fae5)';
                savingsDisplay.style.borderColor = '#10b981';
                
                savingsAmount.textContent = formatFileSize(sizeDifference);
                savingsAmount.style.color = '#047857';
                
                // 節約率と元サイズを表示
                savingsPercentage.textContent = `元サイズから ${compressionRatio}% 削減`;
                originalSizeLabel.textContent = formatFileSize(originalFile.size);
                
                // プログレスバーのアニメーション
                setTimeout(() => {
                    savingsBar.style.width = compressionRatio + '%';
                }, 200);
                
            } else {
                // 圧縬効果なしの表示
                savingsDisplay.style.background = 'linear-gradient(135deg, #fef3c7, #fed7aa)';
                savingsDisplay.style.borderColor = '#f59e0b';
                
                savingsAmount.textContent = '圧縮効果なし';
                savingsAmount.style.color = '#d97706';
                
                savingsPercentage.textContent = 'ファイルサイズは変わりません';
                originalSizeLabel.textContent = formatFileSize(originalFile.size);
                
                savingsBar.style.width = '0%';
            }
            
            // 詳細統計
            document.getElementById('compressedSize').textContent = formatFileSize(compressedBlob.size);
            
            const ratioElement = document.getElementById('compressionRatio');
            ratioElement.textContent = compressionEffective ? `-${compressionRatio}%` : '変化なし';
            
            document.getElementById('resolution').textContent = 
                compressedDimensions ? `${compressedDimensions.width}×${compressedDimensions.height}` : 
                (fileType === 'pdf' ? 'PDFページ' : '-');
            
            // 詳細情報
            const detailedInfo = `元: ${formatFileSize(originalFile.size)} → 結果: ${formatFileSize(compressedBlob.size)}`;
            if (compressionEffective) {
                document.getElementById('compressedInfo').innerHTML = 
                    `${detailedInfo}<br><strong style="color: #059669;">${formatFileSize(sizeDifference)} 節約できました</strong>`;
            } else {
                document.getElementById('compressedInfo').innerHTML = 
                    `${detailedInfo}<br><span style="color: #d97706;">圧縮効果がありませんでした</span>`;
            }
            
            document.getElementById('compressionStats').style.display = 'block';
            
            // 成功アニメーション
            if (compressionEffective) {
                setTimeout(() => {
                    showSuccessAnimation(compressionRatio, formatFileSize(sizeDifference));
                }, 800);
            }
        }

        function updateSuitableServices() {
            if (!compressedBlob) return;
            
            // PDFの場合、サイズのみで判定
            if (fileType === 'pdf') {
                if (compressedBlob.size <= 10 * 1024 * 1024) { // 10MB以下なら適合
                    document.getElementById('suitableServices').style.display = 'block';
                    const servicesList = document.getElementById('servicesList');
                    servicesList.innerHTML = '<div class="p-3 bg-slate-50 rounded-lg border border-slate-200"><span class="text-sm font-medium text-slate-800">メール添付やウェブアップロードに適合</span></div>';
                }
                return;
            }
            
            if (!compressedDimensions) return;

            const suitableServices = Object.entries(services).filter(([_, service]) => {
                return compressedBlob.size <= service.maxSize &&
                       compressedDimensions.width <= service.maxWidth &&
                       compressedDimensions.height <= service.maxHeight;
            });

            if (suitableServices.length > 0) {
                const servicesList = document.getElementById('servicesList');
                servicesList.innerHTML = '';
                
                suitableServices.forEach(([key, service]) => {
                    const serviceCard = document.createElement('div');
                    serviceCard.className = 'p-3 bg-slate-50 rounded-lg border border-slate-200';
                    serviceCard.innerHTML = `
                        <div class="flex items-center gap-2 mb-1">
                            ${service.icon}
                            <span class="text-sm font-medium text-slate-800">${service.name}</span>
                        </div>
                        <p class="text-xs text-slate-500">${service.description}</p>
                    `;
                    servicesList.appendChild(serviceCard);
                });
                
                document.getElementById('suitableServices').style.display = 'block';
            }
        }

        function showLoading() {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingMessage = document.getElementById('loadingMessage');
            const loadingSubMessage = document.getElementById('loadingSubMessage');
            
            loadingMessage.textContent = loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
            loadingSubMessage.textContent = loadingSubMessages[Math.floor(Math.random() * loadingSubMessages.length)];
            
            // プログレスをリセット
            updateProgress(0);
            
            loadingScreen.style.display = 'flex';
        }
        
        function updateLoadingMessage(message) {
            const loadingMessage = document.getElementById('loadingMessage');
            if (loadingMessage) {
                loadingMessage.textContent = message;
            }
        }
        
        function updateProgress(percentage) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            if (progressBar && progressText) {
                progressBar.style.width = percentage + '%';
                progressText.textContent = Math.round(percentage) + '%';
            }
        }

        function hideLoading() {
            document.getElementById('loadingScreen').style.display = 'none';
        }

        function showCompletionAnimation() {
            const message = document.getElementById('loadingMessage');
            const subMessage = document.getElementById('loadingSubMessage');
            
            message.textContent = 'やった〜！圧縮完了です！';
            message.style.color = '#10b981';
            message.style.fontWeight = 'bold';
            
            subMessage.textContent = 'あなたはすごい人です！';
            subMessage.style.color = '#10b981';
            
            document.getElementById('loadingScreen').style.display = 'flex';
            
            setTimeout(() => {
                hideLoading();
            }, 2500);
        }
        
        function showSuccessAnimation(compressionRatio, savedSize) {
            // 成功メッセージを一時的に表示
            const successDiv = document.createElement('div');
            successDiv.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: slideInRight 0.5s ease;">
                    <div style="display: flex; items-center: align-items: center; font-size: 18px; font-weight: bold; margin-bottom: 8px;">
                        <svg style="width: 24px; height: 24px; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        圧縮成功！
                    </div>
                    <div style="font-size: 14px; margin-left: 32px;">${compressionRatio}% 圧縮して<br><strong>${savedSize} 節約できました</strong></div>
                </div>
            `;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }

        function downloadImage() {
            if (!compressedBlob) return;

            const link = document.createElement('a');
            link.href = URL.createObjectURL(compressedBlob);
            const extension = fileType === 'image' ? 'jpg' : 'pdf';
            link.download = `compressed_${Date.now()}.${extension}`;
            link.click();
        }

        function resetAll() {
            originalFile = null;
            compressedBlob = null;
            compressedDimensions = null;
            fileType = 'image';
            
            document.getElementById('previewArea').classList.add('hidden');
            document.getElementById('downloadBtn').classList.add('hidden');
            document.getElementById('compressionStats').style.display = 'none';
            document.getElementById('suitableServices').style.display = 'none';
            document.getElementById('fileInput').value = '';
            
            const slider = document.getElementById('qualitySlider');
            slider.value = 80;
            slider.style.background = 'linear-gradient(to right, #64748b 0%, #64748b 77.78%, #e2e8f0 77.78%, #e2e8f0 100%)';
            document.getElementById('qualityValue').textContent = '80';
            document.getElementById('qualityDisplay').textContent = '80%';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // シェア機能
        function shareOnTwitter() {
            const url = window.location.href;
            const text = '無料で使える画像・PDF圧縮ツール！サイズ削減でストレージ節約✨';
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            window.open(twitterUrl, '_blank', 'width=600,height=400');
        }
        
        function shareOnLine() {
            const url = window.location.href;
            const text = '無料で使える画像・PDF圧縮ツール！';
            const lineUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
            window.open(lineUrl, '_blank', 'width=600,height=400');
        }
        
        async function copyUrlToClipboard() {
            const url = window.location.href;
            try {
                await navigator.clipboard.writeText(url);
                showCopyNotification('✓ URLをコピーしました！');
            } catch (err) {
                // フォールバック: テキストエリアを使用
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopyNotification('✓ URLをコピーしました！');
            }
        }
        
        function shareOnFacebook() {
            const url = window.location.href;
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            window.open(facebookUrl, '_blank', 'width=600,height=400');
        }
        
        function showCopyNotification(message) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1001; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 12px 24px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: slideInTop 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600;">
                        <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        ${message}
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // 圧縮結果付きシェア機能
        function shareOnTwitterWithResult() {
            const url = window.location.href;
            let text = '無料で使える画像・PDF圧縮ツール！';
            
            if (originalFile && compressedBlob) {
                const compressionRatio = Math.round((1 - compressedBlob.size / originalFile.size) * 100);
                const savedSize = formatFileSize(originalFile.size - compressedBlob.size);
                text = `無料PDF・画像圧縮ツールで${compressionRatio}%圧縮して${savedSize}節約できた！✨`;
            }
            
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            window.open(twitterUrl, '_blank', 'width=600,height=400');
        }
        
        function shareOnLineWithResult() {
            const url = window.location.href;
            let text = '無料で使える画像・PDF圧縮ツール！';
            
            if (originalFile && compressedBlob) {
                const compressionRatio = Math.round((1 - compressedBlob.size / originalFile.size) * 100);
                const savedSize = formatFileSize(originalFile.size - compressedBlob.size);
                text = `無料PDF・画像圧縮ツールで${compressionRatio}%圧縮して${savedSize}節約できた！`;
            }
            
            const lineUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
            window.open(lineUrl, '_blank', 'width=600,height=400');
        }
        
        function shareOnFacebookWithResult() {
            const url = window.location.href;
            const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            window.open(facebookUrl, '_blank', 'width=600,height=400');
        }
        
        // その他ツールへのリンク
        function openMoreTools() {
            // GitHub Pagesのメインページにリダイレクト
            window.open('https://yamako1010.github.io/', '_blank');
        }
    </script>
</body>
</html>